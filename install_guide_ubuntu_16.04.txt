// Regis - Node
// Ubuntu 64 bit 16.04 LTS
// Node version used: https://nodejs.org/download/release/v0.10.48/node-v0.10.48-linux-x64.tar.gz

sudo apt-get update
sudo apt-get install git libssl-dev libboost-all-dev build-essential tcl curl gcc g++ cmake
cd /tmp
curl -O http://download.redis.io/redis-stable.tar.gz
tar xzvf redis-stable.tar.gz
cd redis-stable
make
make test
sudo make install
sudo mkdir /etc/redis
sudo cp /tmp/redis-stable/redis.conf /etc/redis
sudo adduser --system --group --no-create-home redis
sudo mkdir /var/lib/redis
sudo chown redis:redis /var/lib/redis
sudo chmod 770 /var/lib/redis

sudo nano /etc/redis/redis.conf
// Change line that starts with "supervised no" to "supervised systemd"
// Change line that starts with "dir ./"  to "dir /var/lib/redis"

cd /tmp
curl -O https://nodejs.org/download/release/v0.10.48/node-v0.10.48-linux-x64.tar.gz
tar xzvf node-v0.10.48-linux-x64.tar.gz
sudo cp /tmp/node-v0.10.48-linux-x64/bin/node /usr/bin/
sudo cp -R /tmp/node-v0.10.48-linux-x64/lib/* /usr/lib/
sudo ln -s /usr/lib/node_modules/npm/bin/npm-cli.js /usr/bin/npm

cd ~
git clone https://github.com/CanadianRepublican/monero-universal-pool.git pool
cd pool
npm update

sudo ufw allow http
sudo ufw allow https
sudo ufw allow 3333
sudo ufw allow 5555
sudo ufw allow 7777
sudo ufw allow 8888

// The config file will need some configuring to work
cp ./config_example.json ./config.json

sudo cp ./utils/redis.service /etc/systemd/system/redis.service
sudo systemctl start redis
sudo systemctl enable redis

// run the pool
node init.js
